<!DOCTYPE html>
<html>
  <head>
    <title>WebSocket example with NoFlo</title>
  </head>
  <body>
    <div style="position: relative; margin-top: 20px;">
      <button style="padding: 2%" id="takeoff">Take off</button>
      <button style="padding: 2%" id="land">Land</button>
      <button style="padding: 2%" id="stop">Stop</button>
      <button style="padding: 2%" id="forward">Forward</button>
      <button style="padding: 2%" id="back">Back</button>
      <button style="padding: 2%" id="right">Right</button>
      <button style="padding: 2%" id="left">Left</button>
    </div>
    
    <div style="position: relative; margin-top: 20px;">
      <input style="padding: 2%; width: 50%" type="number" name="value" id="value">
    </div>  
  </body>
  <script src="../browser/flowcopter.js"></script>
  <script type="application/fbp">
# WebSocket communications
'flowcopter' -> PROTOCOL Connect(websocket/Connect)
'ws://localhost:8000' -> URL Connect()
Connect() CONNECTION -> CONNECTION Send(websocket/SendMessage)
Connect() ERROR -> IN Show(core/Output)
Messages(core/Merge) OUT -> IN ShowMsg(core/Output) OUT -> IN Stringify(strings/Jsonify)
Stringify() OUT -> STRING Send()

# DOM handling
'button' -> SELECTOR GetButtons(dom/GetElement)
GetButtons() ELEMENT -> ELEMENT ListenMouse(interaction/ListenMouse)
'id' -> ATTRIBUTE GetAction(dom/GetAttribute)
'target' -> KEY GetClicked(objects/GetObjectKey)
ListenMouse() CLICK -> IN GetClicked() OUT -> ELEMENT GetAction()
GetAction() OUT -> IN SplitAction(core/Split)

# Create command
SplitAction() OUT -> PROPERTY SetCommand(objects/SetPropertyValue)
'#value' -> SELECTOR GetValueElement(dom/GetElement) ELEMENT -> DATA ValueElement(Kick)
'value' -> KEY ReadValue(objects/GetObjectKey)
ValueElement() OUT -> IN ReadValue() OUT -> VALUE SetCommand()
SplitAction() OUT -> IN ValueElement()
SplitAction() OUT -> START CreateCommand(objects/CreateObject)
CreateCommand() OUT -> IN Disc(core/DisconnectAfterPacket) OUT -> IN SetCommand(objects/SetPropertyValue)
SetCommand() OUT -> IN Messages()
  </script>
  <script>
    var noflo = require('noflo');
    var fbp = document.querySelector('script[type="application/fbp"]');
    var fbpString = fbp.innerText.trim();
    noflo.graph.loadFBP(fbpString, function (graph) {
      graph.baseDir = '/flowcopter';
      noflo.createNetwork(graph);
    });
  </script>
</html>
