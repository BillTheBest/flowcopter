<!DOCTYPE html>
<html>
  <head>
    <title>WebSocket example with NoFlo</title>
  </head>
  <body>
    <form>
      <select name="method">
        <option value="takeoff">Take off</option>
        <option value="land">Land</option>
        <option value="stop">Stop</option>
        <option value="forward">Forward</option>
      </select>
      <input type="number" name="value">
      <button id="send">Send</button>
    </form>
  </body>
  <script src="../browser/flowcopter.js"></script>
  <script type="application/fbp">
'flowcopter' -> PROTOCOL Connect(websocket/Connect)
'ws://localhost:8000' -> URL Connect()
Connect() CONNECTION -> CONNECTION Send(websocket/SendMessage)
Connect() ERROR -> IN Show(core/Output)
Messages(core/Merge) OUT -> IN Stringify(strings/Jsonify)
Stringify() OUT -> STRING Send()
  </script>
  <script>
    var noflo = require('noflo');
    var fbp = document.querySelector('script[type="application/fbp"]');
    var fbpString = fbp.innerText.trim();
    noflo.graph.loadFBP(fbpString, function (graph) {
      graph.baseDir = '/flowcopter';
      noflo.createNetwork(graph, function (network) {
        var button = document.querySelector('#send');
        var messages = network.getNode('Messages');
        var socket = noflo.internalSocket.createSocket();
        messages.component.inPorts['in'].attach(socket);

        button.onclick = function (event) {
          event.preventDefault();

          var method = document.forms[0].elements[0].value;
          var value = document.forms[0].elements[1].value;
          var msg = {}
          msg[method] = value;
          socket.send(msg);
        };
      });
    });
  </script>
</html>
